{% extends "base.html.j2" %}

{% block content %}

{% macro helpaccordion(helpcontents, accordionid) -%}

<div class="accordion list-group" id="{{ accordionid }}">
  {% for helpitem in helpcontents %}
  <div class="accordion-item list-group-item" data-id="{{ helpitem.id }}">
    <h2 class="accordion-header" id="heading{{ helpitem.id }}">
      <div class="input-group">
        <input class="form-control" name="title" id="title" value="{{ helpitem.title }}">
        <span class="input-group-text draghandle"><i class="bi bi-arrow-down-up"></i></span>
        <button class="btn btn-outline-warning" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ helpitem.id }}" aria-expanded="false" aria-controls="collapse{{ helpitem.id }}"><i class="bi bi-pencil-fill"></i></button>
      </div>
    </h2>
    <div id="collapse{{ helpitem.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ helpitem.id }}" data-bs-parent="#{{ accordionid }}">
      <div class="accordion-body">
        <textarea class="form-control" name="body" id="body" rows="5">{{ helpitem.body }}</textarea>
        <div class="d-grid my-3 gap-3 d-md-flex col-12 justify-content-md-end">
          <button type="button" class="btn btn-info">Podgląd</button>
          <button type="button" class="btn btn-success">Zapisz</button>
          <button type="button" class="btn btn-danger">Usuń</button>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{%- endmacro %}

<h1>Pomoc</h1>
<p>Witamy w kalendarzu adwentowym na kolejny rok! :)</p>

{{ helpaccordion(userhelp, "accordionHelpUser") }}

{% if admin %}
<p></p>
<h1>Dla administratorów</h1>
<p></p>

{{ helpaccordion(adminhelp, "accordionHelpAdmin") }}

<div class="d-grid my-3 gap-3 d-md-flex col-12 justify-content-md-end">
  <button type="button" class="btn btn-warning">Dodaj nową pozycję</button>
  <button type="button" class="btn btn-success">Zapisz kolejność</button>
</div>

{% endif %}
{% endblock %}

{% block scripts %}
  {{ super() }}

  <!-- jsDelivr :: Sortable :: Latest (https://www.jsdelivr.com/package/npm/sortablejs) -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

  <script type="text/javascript">

    function createSortable(sortableName){
      Sortable.create(sortableName, {
        handle: '.draghandle',
        animation: 150,
        group: "localStorageHelp",
        store: {
          get: function(sortable) { },
          set: function(sortable) {
            var order = sortable.toArray();
            sessionStorage.setItem(sortableName, order);
          }
        }
      });
    }

    createSortable(accordionHelpUser);
    createSortable(accordionHelpAdmin);

  </script>

{% endblock %}